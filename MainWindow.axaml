<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FIXSniff.ViewModels"
        xmlns:models="using:FIXSniff.Models"
        x:Class="FIXSniff.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="FIXSniff - FIX Message Parser"
        Width="1200"
        Height="800">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="200,Auto,*,Auto,100">
        <!-- Input Area -->
        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" Padding="10" Margin="10,10,10,5">
            <Grid RowDefinitions="Auto,Auto,*">
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Paste FIX Messages (one per line):" FontWeight="Bold" VerticalAlignment="Center"/>
                    <Button Content="ðŸŒ™" Click="ToggleTheme_Click" Margin="10,0,0,0" ToolTip.Tip="Toggle Dark/Light Theme"/>
                </StackPanel>
                <TextBox Grid.Row="2" 
                         Text="{Binding InputText}" 
                         AcceptsReturn="True" 
                         TextWrapping="Wrap"
                         FontFamily="Consolas,Monaco,monospace"
                         FontSize="12"
                         Watermark="8=FIX.4.4|9=178|35=D|49=SENDER|56=TARGET|34=1|52=20230101-10:30:00|11=ORDER123|21=1|55=MSFT|54=1|38=100|40=2|44=150.50|59=0|10=123"/>
            </Grid>
        </Border>

        <!-- Parse Button -->
        <Button Grid.Row="1" 
                Content="Parse Messages" 
                Command="{Binding ParseCommand}"
                HorizontalAlignment="Center"
                Margin="10,5"
                Padding="20,8"
                FontWeight="Bold"
                Background="#0066CC"
                Foreground="White"/>

        <!-- Tabs Area -->
        <TabControl Grid.Row="2" 
                    ItemsSource="{Binding ParsedTabs}"
                    Margin="10,5,10,5"
                    Background="White">
            <TabControl.ItemTemplate>
                <DataTemplate DataType="vm:ParsedTabViewModel">
                    <TextBlock Text="{Binding TabHeader}" Padding="8,4"/>
                </DataTemplate>
            </TabControl.ItemTemplate>
            
            <TabControl.ContentTemplate>
                <DataTemplate DataType="vm:ParsedTabViewModel">
                    <Grid RowDefinitions="*,5,Auto">
                        <!-- Error message if parsing failed -->
                        <Border Grid.Row="0" 
                                IsVisible="{Binding ParsedMessage.HasError}"
                                Background="#FFEBEE"
                                BorderBrush="#F44336"
                                BorderThickness="1"
                                Padding="10"
                                Margin="10">
                            <StackPanel>
                                <TextBlock Text="Parsing Error:" FontWeight="Bold" Foreground="#D32F2F" Margin="0,0,0,5"/>
                                <TextBlock Text="{Binding ParsedMessage.ErrorMessage}" 
                                           TextWrapping="Wrap" 
                                           Foreground="#D32F2F"/>
                                <TextBlock Text="Raw message:" FontWeight="Bold" Margin="0,10,0,5"/>
                                <TextBox Text="{Binding ParsedMessage.RawMessage}" 
                                         IsReadOnly="True"
                                         FontFamily="Consolas,Monaco,monospace"
                                         FontSize="11"
                                         Background="#FAFAFA"/>
                            </StackPanel>
                        </Border>

                        <!-- Fields Grid -->
                        <DataGrid Grid.Row="0" 
                                  ItemsSource="{Binding Fields}"
                                  IsVisible="{Binding !ParsedMessage.HasError}"
                                  AutoGenerateColumns="False"
                                  CanUserReorderColumns="False"
                                  CanUserSortColumns="True"
                                  GridLinesVisibility="All"
                                  HeadersVisibility="Column"
                                  SelectionMode="Single"
                                  SelectionChanged="DataGrid_SelectionChanged"
                                  Margin="10">
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Tag" 
                                                    Binding="{Binding DisplayTagNumber}" 
                                                    Width="100"
                                                    FontFamily="Consolas,Monaco,monospace"/>
                                <DataGridTextColumn Header="Field Name" 
                                                    Binding="{Binding FieldName}" 
                                                    Width="200"/>
                                <DataGridTextColumn Header="Value" 
                                                    Binding="{Binding Value}" 
                                                    Width="*"
                                                    FontFamily="Consolas,Monaco,monospace"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <GridSplitter Grid.Row="1" 
                                      Height="5" 
                                      HorizontalAlignment="Stretch" 
                                      Background="#E0E0E0"/>
                    </Grid>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </TabControl>

        <GridSplitter Grid.Row="3" 
                      Height="5" 
                      HorizontalAlignment="Stretch" 
                      Background="#E0E0E0"/>

        <!-- Field Description -->
        <Border Grid.Row="4" Background="#F9F9F9" Padding="10" Margin="10,5,10,10">
            <Grid RowDefinitions="Auto,*">
                <TextBlock Text="Field Description:" FontWeight="Bold" Margin="0,0,0,5"/>
                <TextBox Grid.Row="1"
                         Text="{Binding SelectedFieldDescription}"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         Background="White"
                         FontSize="12"
                         Watermark="Select a field from the grid above to see its description"/>
            </Grid>
        </Border>
    </Grid>
</Window>